<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia√ß√£o de Conformidade - PMO ANC</title>

    <!-- Framework CSS -->
    <link rel="stylesheet" href="../../framework/core/pmo-framework-full.css">

    <!-- CSS Espec√≠fico de Avalia√ß√£o -->
    <link rel="stylesheet" href="./avaliacao.css">
</head>
<body>
    <!-- Header -->
    <div class="avaliacao-container">
        <header class="avaliacao-header">
            <h1>üìã Avalia√ß√£o de Conformidade - PMO</h1>
            <p>Sistema de avalia√ß√£o e verifica√ß√£o de conformidade org√¢nica</p>

            <div class="header-actions">
                <button class="btn btn-secondary" onclick="AvaliacaoPMO.voltarPainel()">
                    ‚Üê Voltar ao Painel
                </button>
            </div>
        </header>

        <!-- Etapa 1: Upload do PMO -->
        <section id="etapa-upload" class="etapa-section active">
            <div class="etapa-header">
                <h2>1Ô∏è‚É£ Upload do PMO para Avalia√ß√£o</h2>
                <p>Fa√ßa upload do PDF ou JSON do PMO que deseja avaliar</p>
            </div>

            <div class="upload-area-wrapper">
                <div class="upload-area" id="upload-area">
                    <input
                        type="file"
                        id="upload-input"
                        accept="application/pdf,application/json"
                        onchange="AvaliacaoPMO.handleFileSelect(event)"
                    >
                    <div class="upload-icon">üìÑ</div>
                    <div class="upload-text">Clique ou arraste o PDF/JSON aqui</div>
                    <div class="upload-hint">PDF exportado ou arquivo JSON do PMO</div>
                </div>
                <div id="upload-status" class="upload-status"></div>
            </div>
        </section>

        <!-- Etapa 2: Dados do Avaliador -->
        <section id="etapa-avaliador" class="etapa-section">
            <div class="etapa-header">
                <h2>2Ô∏è‚É£ Dados do Avaliador</h2>
                <p>Informe seus dados para identifica√ß√£o na avalia√ß√£o</p>
            </div>

            <form id="form-avaliador" class="form-avaliador">
                <div class="form-grid">
                    <div class="field-wrapper col-span-2">
                        <label for="avaliador_nome">
                            Nome Completo do Avaliador
                            <span class="required">*</span>
                        </label>
                        <input type="text" id="avaliador_nome" name="avaliador_nome" required placeholder="Nome completo">
                    </div>

                    <div class="field-wrapper">
                        <label for="avaliador_cpf">
                            CPF
                            <span class="required">*</span>
                        </label>
                        <input type="text" id="avaliador_cpf" name="avaliador_cpf" required placeholder="000.000.000-00">
                    </div>

                    <div class="field-wrapper">
                        <label for="avaliador_cargo">Cargo/Fun√ß√£o</label>
                        <input type="text" id="avaliador_cargo" name="avaliador_cargo" placeholder="Ex: T√©cnico ANC">
                    </div>

                    <div class="field-wrapper col-span-2">
                        <label for="avaliador_observacao_geral">Observa√ß√£o Geral</label>
                        <textarea id="avaliador_observacao_geral" name="avaliador_observacao_geral" rows="3" placeholder="Observa√ß√µes gerais sobre a avalia√ß√£o (opcional)"></textarea>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="AvaliacaoPMO.voltarEtapa()">
                        ‚Üê Voltar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="AvaliacaoPMO.iniciarAvaliacao()">
                        Iniciar Avalia√ß√£o ‚Üí
                    </button>
                </div>
            </form>
        </section>

        <!-- Etapa 3: Avalia√ß√£o -->
        <section id="etapa-avaliacao" class="etapa-section">
            <div class="etapa-header">
                <h2>3Ô∏è‚É£ Avalia√ß√£o de Conformidade</h2>
                <p>Revise cada se√ß√£o e adicione observa√ß√µes sobre a conformidade</p>

                <div class="progress-avaliacao">
                    <div class="progress-info">
                        <span>Progresso: <strong id="progresso-count">0/0</strong></span>
                        <span>Conformidade: <strong id="conformidade-score">0%</strong></span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progress-bar-avaliacao" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Resumo do PMO -->
            <div class="pmo-resumo-card">
                <h3>üìÑ PMO em Avalia√ß√£o</h3>
                <div id="pmo-resumo-info"></div>
            </div>

            <!-- Se√ß√µes de Avalia√ß√£o -->
            <div id="secoes-avaliacao"></div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="AvaliacaoPMO.salvarProgresso()">
                    üíæ Salvar Progresso
                </button>
                <button type="button" class="btn btn-primary" onclick="AvaliacaoPMO.finalizarAvaliacao()">
                    ‚úÖ Finalizar Avalia√ß√£o
                </button>
            </div>
        </section>

        <!-- Etapa 4: Resultado -->
        <section id="etapa-resultado" class="etapa-section">
            <div class="etapa-header">
                <h2>4Ô∏è‚É£ Resultado da Avalia√ß√£o</h2>
                <p>Resumo da avalia√ß√£o e gera√ß√£o de relat√≥rio</p>
            </div>

            <div class="resultado-card">
                <div class="resultado-score">
                    <div class="score-circle">
                        <svg width="200" height="200">
                            <circle cx="100" cy="100" r="90" fill="none" stroke="#e2e8f0" stroke-width="20"/>
                            <circle
                                id="score-circle"
                                cx="100"
                                cy="100"
                                r="90"
                                fill="none"
                                stroke="#48bb78"
                                stroke-width="20"
                                stroke-dasharray="565.48"
                                stroke-dashoffset="565.48"
                                transform="rotate(-90 100 100)"
                            />
                            <text x="100" y="100" text-anchor="middle" dy="0.3em" font-size="48" font-weight="bold" id="score-text">0%</text>
                        </svg>
                    </div>
                    <h3 id="resultado-titulo">Conformidade Geral</h3>
                    <p id="resultado-descricao"></p>
                </div>

                <div class="resultado-detalhes" id="resultado-detalhes"></div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="AvaliacaoPMO.novaAvaliacao()">
                    ‚ûï Nova Avalia√ß√£o
                </button>
                <button type="button" class="btn btn-primary" onclick="AvaliacaoPMO.exportarPDFAvaliacao()">
                    üì• Exportar PDF de Avalia√ß√£o
                </button>
                <button type="button" class="btn btn-secondary" onclick="AvaliacaoPMO.voltarPainel()">
                    üè† Voltar ao Painel
                </button>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="pmo-footer">
        <p>&copy; 2024 ANC - Associa√ß√£o de Agricultura Natural de Campinas e Regi√£o</p>
        <p>Sistema de Avalia√ß√£o de Conformidade PMO</p>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/pdf-lib"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="../../framework/core/pmo-framework.js"></script>
    <script src="../../framework/components/export.js"></script>
    <script src="../../framework/components/avaliacao-storage.js"></script>
    <script src="./avaliacao.js"></script>

    <script>
        // Inicializar quando DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            AvaliacaoPMO.init();
        });
    </script>
</body>
</html>
